CREATE SCHEMA estudo_caso5_CC1N;
USE estudo_caso5_CC1N;

# TABELAS SEM CHAVES ESTRANGEIRAS
CREATE TABLE CLIENTES (
    CLIENTE_ID INT PRIMARY KEY,
    CLIENTE_NOME VARCHAR(100) NOT NULL,
    CLIENTE_CPF VARCHAR(15) NOT NULL UNIQUE,
    CLIENTE_DATA_NASCIMENTO DATE NOT NULL,
    CLIENTE_ESTADO VARCHAR(30) NOT NULL,
    CLIENTE_CIDADE VARCHAR(45) NOT NULL,
    CLIENTE_RUA VARCHAR(50) NOT NULL,
    CLIENTE_NUMERO INT NOT NULL CHECK (CLIENTE_NUMERO > 0),
    CLIENTE_CEP VARCHAR(10) NOT NULL,
    CLIENTE_PROGRAMA_FIDELIDADE BOOLEAN NOT NULL);

CREATE TABLE FORNECEDORES (
    FORNECEDOR_ID INT PRIMARY KEY,
    FORNECEDOR_NOME VARCHAR(100) NOT NULL,
    FORNECEDOR_TELEFONE VARCHAR(15) NOT NULL,
    FORNECEDOR_EMAIL VARCHAR(100) NOT NULL UNIQUE,
    FORNECEDOR_ESTADO VARCHAR(30) NOT NULL,
    FORNECEDOR_CIDADE VARCHAR(45) NOT NULL,
    FORNECEDOR_RUA VARCHAR(50) NOT NULL,
    FORNECEDOR_NUMERO INT NOT NULL,
    FORNECEDOR_CEP VARCHAR(10) NOT NULL);

#COM CHAVES ESTRANGEIRAS
CREATE TABLE PRODUTOS (
    PRODUTO_ID INT PRIMARY KEY,
    PRODUTO_NOME VARCHAR(100) NOT NULL,
    PRODUTO_CATEGORIA VARCHAR(50) NOT NULL,
    PRODUTO_PRECO DECIMAL(10,3) NOT NULL,
    PRODUTO_QUANTIDADE_ESTOQUE INT NOT NULL,
    FORNECEDOR_ID INT,
    CONSTRAINT FK_PRODUTOS_FORNECEDOR FOREIGN KEY (FORNECEDOR_ID) REFERENCES FORNECEDORES(FORNECEDOR_ID));

CREATE TABLE VENDAS (
    VENDA_ID INT PRIMARY KEY,
    VENDA_DATA DATE NOT NULL,
    VENDA_FORMA_PAGAMENTO VARCHAR(20) NOT NULL,
    CLIENTE_ID INT,
    CONSTRAINT FK_VENDAS_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES(CLIENTE_ID));

CREATE TABLE PAGAMENTOS (
    PAGAMENTO_ID INT PRIMARY KEY,
    PAGAMENTO_DATA DATE NOT NULL,
    PAGAMENTO_VALOR DECIMAL(10, 2) NOT NULL,
    PAGAMENTO_STATUS BOOLEAN NOT NULL,
    VENDA_ID INT,
    CONSTRAINT FK_PAGAMENTOS_VENDA FOREIGN KEY (VENDA_ID) REFERENCES VENDAS(VENDA_ID));

#ENTIDADES ASSOCIATIVAS
CREATE TABLE PRODUTOS_VENDIDOS (
    VENDA_ID INT,
    PRODUTO_ID INT,
    QUANTIDADE INT NOT NULL,
    PRIMARY KEY (VENDA_ID, PRODUTO_ID),
    CONSTRAINT FK_PRODUTOS_VENDIDOS_VENDA FOREIGN KEY (VENDA_ID) REFERENCES VENDAS(VENDA_ID),
    CONSTRAINT FK_PRODUTOS_VENDIDOS_PRODUTO FOREIGN KEY (PRODUTO_ID) REFERENCES PRODUTOS(PRODUTO_ID));
    
INSERT INTO CLIENTES (CLIENTE_ID, CLIENTE_NOME, CLIENTE_CPF, CLIENTE_DATA_NASCIMENTO, CLIENTE_ESTADO, CLIENTE_CIDADE, CLIENTE_RUA, CLIENTE_NUMERO, CLIENTE_CEP, CLIENTE_PROGRAMA_FIDELIDADE) VALUES 
(1, 'Alice Pereira', '11111111111', '1990-05-21', 'ES', 'Vitória', 'Rua A', 10, '29100-000', TRUE),
(2, 'Bruno Lima', '22222222222', '1988-10-15', 'ES', 'Guarapari', 'Rua B', 20, '29100-001', FALSE),
(3, 'Carlos Dias', '33333333333', '1995-01-10', 'ES', 'Vila Velha', 'Rua C', 30, '29100-002', TRUE),
(4, 'Daniela Fernandes', '44444444444', '1980-07-25', 'ES', 'Serra', 'Rua D', 40, '29100-003', FALSE),
(5, 'Eduardo Souza', '55555555555', '2002-12-12', 'ES', 'Cariacica', 'Rua E', 50, '29100-004', TRUE);

INSERT INTO FORNECEDORES (FORNECEDOR_ID, FORNECEDOR_NOME, FORNECEDOR_TELEFONE, FORNECEDOR_EMAIL, FORNECEDOR_ESTADO, FORNECEDOR_CIDADE, FORNECEDOR_RUA, FORNECEDOR_NUMERO, FORNECEDOR_CEP) VALUES 
(1, 'Fornecedor A', '27999999999', 'contato@fornecedora.com', 'ES', 'Vitória', 'Rua X', 10, '29100-100'),
(2, 'Fornecedor B', '27988888888', 'contato@fornecedorb.com', 'ES', 'Guarapari', 'Rua Y', 20, '29100-101'),
(3, 'Fornecedor C', '27977777777', 'contato@fornecedorc.com', 'ES', 'Vila Velha', 'Rua Z', 30, '29100-102'),
(4, 'Fornecedor D', '27966666666', 'contato@fornecedord.com', 'ES', 'Serra', 'Rua W', 40, '29100-103'),
(5, 'Fornecedor E', '27955555555', 'contato@fornecedore.com', 'ES', 'Cariacica', 'Rua V', 50, '29100-104');

INSERT INTO PRODUTOS (PRODUTO_ID, PRODUTO_NOME, PRODUTO_CATEGORIA, PRODUTO_PRECO, PRODUTO_QUANTIDADE_ESTOQUE, FORNECEDOR_ID) VALUES 
(1, 'Produto A', 'Eletrônicos', 150.00, 50, 1),
(2, 'Produto B', 'Eletrodomésticos', 250.00, 30, 2),
(3, 'Produto C', 'Móveis', 100.00, 20, 3),
(4, 'Produto D', 'Roupas', 50.00, 100, 4),
(5, 'Produto E', 'Calçados', 80.00, 75, 5);

INSERT INTO VENDAS (VENDA_ID, VENDA_DATA, VENDA_FORMA_PAGAMENTO, CLIENTE_ID) VALUES 
(1, '2024-11-01', 'Cartão de Crédito', 1),
(2, '2024-11-02', 'Boleto', 2),
(3, '2024-11-03', 'Dinheiro', 3),
(4, '2024-11-04', 'Cartão de Débito', 4),
(5, '2024-11-05', 'Pix', 5);

INSERT INTO PAGAMENTOS (PAGAMENTO_ID, PAGAMENTO_DATA, PAGAMENTO_VALOR, PAGAMENTO_STATUS, VENDA_ID) VALUES 
(1, '2024-11-01', 150.00, TRUE, 1),
(2, '2024-11-02', 250.00, TRUE, 2),
(3, '2024-11-03', 100.00, FALSE, 3),
(4, '2024-11-04', 50.00, TRUE, 4),
(5, '2024-11-05', 80.00, FALSE, 5);

INSERT INTO PRODUTOS_VENDIDOS (VENDA_ID, PRODUTO_ID, QUANTIDADE) VALUES 
(1, 1, 2),
(1, 2, 1),
(2, 3, 3),
(3, 4, 1),
(4, 5, 2);

UPDATE CLIENTES SET CLIENTE_PROGRAMA_FIDELIDADE = FALSE WHERE CLIENTE_ID = 1;
UPDATE CLIENTES SET CLIENTE_CIDADE = 'Vitória' WHERE CLIENTE_ID = 2;

UPDATE FORNECEDORES SET FORNECEDOR_CEP = '29100-200' WHERE FORNECEDOR_ID = 1;
UPDATE FORNECEDORES SET FORNECEDOR_CIDADE = 'Serra' WHERE FORNECEDOR_ID = 2;

UPDATE PRODUTOS SET PRODUTO_PRECO = 200.00 WHERE PRODUTO_ID = 1;
UPDATE PRODUTOS SET PRODUTO_QUANTIDADE_ESTOQUE = 45 WHERE PRODUTO_ID = 2;

UPDATE VENDAS SET VENDA_FORMA_PAGAMENTO = 'Pix' WHERE VENDA_ID = 1;
UPDATE VENDAS SET VENDA_DATA = '2024-11-06' WHERE VENDA_ID = 2;

UPDATE PAGAMENTOS SET PAGAMENTO_STATUS = FALSE WHERE PAGAMENTO_ID = 1;
UPDATE PAGAMENTOS SET PAGAMENTO_VALOR = 260.00 WHERE PAGAMENTO_ID = 2;

UPDATE PRODUTOS_VENDIDOS SET QUANTIDADE = 3 WHERE VENDA_ID = 1 AND PRODUTO_ID = 1;
UPDATE PRODUTOS_VENDIDOS SET QUANTIDADE = 2 WHERE VENDA_ID = 2 AND PRODUTO_ID = 3;

DELETE FROM PAGAMENTOS WHERE PAGAMENTO_ID = 5;

